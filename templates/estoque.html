<!-- EXTENDENDO O CSS DA PAGINA PRINCIPAL (LAYOUT) -->
{% block css %}
<link rel="stylesheet" href="/static/styles/estoque.css">
<link rel="stylesheet" href="/static/styles/media/estoque-media.css">
<link rel="stylesheet" href="/static/styles/media/layout-media.css">
<link rel="stylesheet" href="/static/styles/variaveis.css">

{% endblock %}

{% extends "layout.html" %}
{% block conteudo %}

    <!-- Section 01. 
    Essa Section possui um espaço para imagem (cor solicitada pelo cliente) e nome da matéria. -->
<section class="geral-cadastramento">
    <div class="container-cadastramento">
        <div class="cadastramento-titulo">
            <span class="controle1">CONTROLE DE</span>
            <span class="controle2">ESTOQUE</span>
        </div>
    </div>

    <section class="container-tabela">
        <h1>Produtos Cadastrados</h1>
        <table>
            <thead>
                <tr>
                    <th>Código</th>
                    <th>Descrição</th>
                    <th>Modelo</th>
                    <th>Fabricante</th>
                    <th>Número do Lote</th>
                    <th>Endereçamento</th>
                </tr>
            </thead>
            <tbody>
                {% for produto in lista_produtos %}
                <tr>
                    <td>{{ produto['codigo'] }}</td>
                    <td>{{ produto['descricao'] }}</td>
                    <td>{{ produto['modelo'] }}</td>
                    <td>{{ produto['fabricante'] }}</td>
                    <td>{{ produto['numero_lote'] }}</td>
                    <td>{{ produto['enderecamento'] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </section>

    <!-- Formulário para cadastro de estoque com todos os campos originais -->
    <div class="formulario">
        <div class="form_container">
            <form action="/estoque" method="POST">
                <span class="cadastramentoD"> Cadastrar dados: </span>
                
                <!-- Campo de código do produto para busca automática -->
                <input type="number" placeholder="Código do Produto" class="input-field" name="cod_prod" id="cod_prod">
                
                <!-- Campos já existentes para informações do produto -->
                <input type="number" placeholder="Número de Lote" class="input-field" name="num_lt" id="num_lt">
                <input type="text" placeholder="Localização" class="input-field" name="loc_" id="loc_">
                <textarea placeholder="Descrição Técnica" class="textarea-field" name="descricao" id="descricao"></textarea>
                <span class="cadastramento">Data de entrada:</span>
                <input type="date" placeholder="Data de Entrada:" class="input-field" name="dt_enter">
                <input type="number" placeholder="Quantidade de itens" class="input-field" name="qt_item">
                <span class="cadastramento">Data de saída:</span>
                <input type="date" placeholder="Data de Saída:" class="input-field" name="dt_end">
                <input type="number" placeholder="Quantidade da Saída" class="input-field" name="qt_saida">
                <input type="number" placeholder="Saldo" class="input-field" name="_saldo">
                <input type="text" placeholder="Funcionário Responsável" class="input-field" name="funcionario">

                <!-- Botão de envio do formulário -->
                <button class="submit-btn">Enviar</button>
            </form>
        </div>
    </div>
</section>
    
<script>
    // JavaScript para preenchimento automático ao sair do campo de código do produto
    document.getElementById("cod_prod").addEventListener("blur", function() {
        let codigo = this.value;  // Obtém o valor digitado no campo de código
        if (codigo.length > 0) {  // Verifica se o campo não está vazio
            fetch(`/produto-info/${codigo}`)  // Requisição GET para a rota /produto-info com o código do produto
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error('Produto não encontrado');
                })
                .then(data => {
                    // Preenche os campos com as informações do produto
                    document.getElementById("descricao").value = data.descricao || '';
                    document.getElementById("loc_").value = data.enderecamento || '';
                    document.getElementById("num_lt").value = data.numero_lote || '';
                })
                .catch(error => console.error('Erro ao buscar dados do produto:', error));  // Exibe erros no console
        }
    });
</script>
    

{% endblock %}